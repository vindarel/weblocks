<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Components of Weblocks &#8212; weblocks 0.13.7 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/yeti/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.13.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Stores" href="stores.html" />
    <link rel="prev" title="Installation" href="installation.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          weblocks</a>
        <span class="navbar-text navbar-version pull-left"><b>0.13</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="changelog.html">Changelog</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Components of Weblocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="stores.html">Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets.html">Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="continuations.html">Continuation-based tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependency handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="html.html">HTML generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="adapting.html">Adapting Weblocks to your needs</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Weblocks Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Weblocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="hints.html">Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">ChangeLog</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Components of Weblocks</a><ul>
<li><a class="reference internal" href="#widgets">Widgets</a></li>
<li><a class="reference internal" href="#actions">Actions</a></li>
<li><a class="reference internal" href="#navigations-and-dispatchers">Navigations and dispatchers</a></li>
<li><a class="reference internal" href="#views">Views</a></li>
<li><a class="reference internal" href="#templates">Templates</a><ul>
<li><a class="reference internal" href="#template-function">Template function</a></li>
<li><a class="reference internal" href="#template-definition">Template definition</a></li>
<li><a class="reference internal" href="#template-rendering">Template rendering</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="components-of-weblocks">
<h1>Components of Weblocks<a class="headerlink" href="#components-of-weblocks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="widgets">
<h2>Widgets<a class="headerlink" href="#widgets" title="Permalink to this headline">¶</a></h2>
<p>Widgets are the main building blocks of Weblocks (hence the name).</p>
<p>TODO
At the heart of Weblocks is a tree`&#8217;w_footnote(An acyclic graph with exactly one
parent per node) of widgets that is manipulated by the clients requests. When a
client sends its first request to a Weblocks application then a new session is
started for it and a widget tree is associated with this session.</p>
<p>This initial widget tree is computed as defined by the application developer.
A special function (usually called <code class="docutils literal"><span class="pre">init-user-session</span></code>) is called by Weblocks
to initialize a new session. This function then proceeds to set up a
widget tree by adding children to the root of the widget tree
(accessible with the macro <code class="docutils literal"><span class="pre">root-widget</span></code>).</p>
<p>The initial content and structure of the widget tree may depend on arbitrary
factors; it is conceivable (although probably not very sensible) to generate
different widget trees depending on the time of day.</p>
<p>A client&#8217;s request for a specific URI modifies the widget tree: widgets
called /dispatchers/ choose their one child based on the current request
URI.</p>
<p>There is a convenience function <code class="docutils literal"><span class="pre">MAKE-WIDGET</span></code> that creates widgets
from strings (anything that can be printed, in fact) and functions.</p>
</div>
<div class="section" id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p>Apart from session initialization the widget tree may be modified by /actions/.</p>
<p>Actions are plain functions that are stored in a session hash table the keys
of which are unique identifiers. This way they can be called by the browser.</p>
<p>When Javascript is available actions will be called via AJAX, otherwise
a normal request will be initiated.</p>
<p>It is often useful to set up closures as actions.</p>
<p>Example of typical action usage:</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defwidget</span> <span class="nv">counter</span> <span class="p">()</span>
  <span class="p">((</span><span class="nb">count</span> <span class="ss">:accessor</span> <span class="nv">count-of</span> <span class="ss">:initform</span> <span class="mi">0</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defmethod</span> <span class="nv">render-widget-body</span> <span class="p">((</span><span class="nv">widget</span> <span class="nv">counter</span><span class="p">)</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">with-html</span>
    <span class="p">(</span><span class="ss">:p</span> <span class="p">(</span><span class="nv">esc</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;The counter is at ~D.&quot;</span> <span class="p">(</span><span class="nv">count-of</span> <span class="nv">widget</span><span class="p">))))</span>
    <span class="p">(</span><span class="ss">:p</span> <span class="p">(</span><span class="nv">render-link</span>
         <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
          <span class="c1">;; closes over WIDGET.</span>
          <span class="p">(</span><span class="nb">incf</span> <span class="p">(</span><span class="nv">count-of</span> <span class="nv">widget</span><span class="p">)))</span>
         <span class="s">&quot;Count up!&quot;</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="section" id="navigations-and-dispatchers">
<h2>Navigations and dispatchers<a class="headerlink" href="#navigations-and-dispatchers" title="Permalink to this headline">¶</a></h2>
<p>Dispatchers are widgets that configure themselves and their children
(i.e. broadly speaking the widget tree) based on the URI of the request.</p>
<p>TODO
Navigations are dispatchers that maintain a simple one-to-one association between
an URI token`&#8217;w_footnote(each path component of an URI is a token; for example
in <code class="docutils literal"><span class="pre">&quot;/foo/bar/quux&quot;</span></code> there are three tokens foo bar and quux.) and
a widget.</p>
<p>Note that each widget can also in turn be a navigation that consumes an
URI token, thereby building a many-to-many relationship between tokens
and widgets.</p>
<p>The function <code class="docutils literal"><span class="pre">MAKE-NAVIGATION</span></code> is a convenience frontend for building
navigations.</p>
<p>The first argument is a title for the navigation. The rest of the arguments
map tokens to widgets:</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">init-user-session</span> <span class="p">(</span><span class="nv">root</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">widget-children</span> <span class="nv">root</span><span class="p">)</span> <span class="p">(</span><span class="nv">make-navigation</span> <span class="s">&quot;Food Shop&quot;</span>
                                <span class="s">&quot;Fruits&quot;</span> <span class="p">(</span><span class="nv">make-fruit-navigation</span><span class="p">)</span>
                                <span class="s">&quot;Vegetables&quot;</span> <span class="p">(</span><span class="nv">make-vegetables-navigation</span><span class="p">)</span>
                                <span class="s">&quot;Billing&quot;</span> <span class="p">(</span><span class="nb">make-instance</span> <span class="ss">&#39;billing-widget</span> <span class="ss">:shop-type</span> <span class="ss">&#39;food</span><span class="p">))))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">MAKE-WIDGET</span></code> is applied to the widget argument so you can use strings
and function designators`&#8217;w_footnote(i.e. symbols naming a global function
and function objects themselves) instead of widgets in this context.</p>
</div>
<div class="section" id="views">
<h2>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p>Views provide convenient ways to define how data object are to
be rendered.</p>
<p>Weblocks currently comes with three types of views: data views, table views
and form views.</p>
<p>Form views are especially useful because they let you build forms
in a declarative manner, error checking and reporting included.</p>
<p>Views mainly consist of a rendering framework unique to the
view and a series of view fields. The table view for example knows how to render a HTML table.</p>
<p>View fields usually map to the slots of your data class but they are
flexible enough to be used in any other way. Associated with each view field
regardless of the view type are things like a human-readable label and
information on how to render the field (presentation).</p>
<p>Form views include additional parameters like how to translate user
input to a proper model value (parser) and constraints on the data
(satisfies).</p>
</div>
<div class="section" id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h2>
<p>Template is something different from view.  It is another layer which
allows to customize views look.  Most of weblocks code support templates
and this gives us ability to change widget html without changing widget
logic.  We get rid of method overriding for widgets and override only
template.</p>
<p>Templates bring theming functionality into Weblocks, can be used to
simplify some debugging work and to improve widgets reusing.</p>
<p>You can build your own widgets without templates.</p>
<p>Templates are necessary for widgets which you want to be
reused. Weblocks contains much of such widgets.</p>
<p>Also if you want to make your own Weblocks theme you should use templates.</p>
<p>Template is ...</p>
<ul class="simple">
<li>template function</li>
<li>template definition</li>
</ul>
<p>And templates should be rendered inside of widgets.</p>
<div class="section" id="template-function">
<h3>Template function<a class="headerlink" href="#template-function" title="Permalink to this headline">¶</a></h3>
<p>Template function should receive some key parameters and return html string.
You can use any html generation library or template library for templates.</p>
<p>We encourage you to</p>
<ul class="simple">
<li>use naming convention and call template <code class="docutils literal"><span class="pre">*-wt</span></code> (with &#8220;-wt&#8221; suffix
). &#8220;wt&#8221; means either &#8220;web template&#8221; or &#8220;Weblocks template&#8221;. Since
template should be overriden often, name convention will made easier
to find what we need.</li>
<li>use <code class="docutils literal"><span class="pre">&amp;allow-other-keys</span></code> in every template.</li>
<li>use no complex logic and no computations in templates. Just simple
iteration over lists and if statements when you use cl-who. The best
thing would be to use no more logic then in mustache templates
w_url(<cite>http://mustache.github.io/mustache.5.html&#8217;) For cl-who
``format`</cite>, <code class="docutils literal"><span class="pre">concatenate</span></code> and other string functions could be used
(concatenation is allowed), but avoid to use number operations.</li>
</ul>
<p>Here is template example.</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-wt</span> <span class="p">(</span><span class="k">&amp;key</span> <span class="p">(</span><span class="nv">content</span> <span class="s">&quot;I&#39;m template&quot;</span><span class="p">)</span> <span class="k">&amp;allow-other-keys</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">with-html-to-string</span>
        <span class="p">(</span><span class="ss">:p</span> <span class="p">(</span><span class="nv">str</span> <span class="nv">content</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="section" id="template-definition">
<h3>Template definition<a class="headerlink" href="#template-definition" title="Permalink to this headline">¶</a></h3>
<p>Template definition is a <code class="docutils literal"><span class="pre">deftemplate</span></code> call.</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">deftemplate</span> <span class="ss">:my-wt</span> <span class="ss">&#39;my-wt</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we just connected <code class="docutils literal"><span class="pre">:my-wt</span></code> template name with template function <code class="docutils literal"><span class="pre">'my-wt</span></code>.</p>
<p>And here comes most important templates part.
We can connect many template functions to template name and only one of them - effective template - will be called.
Effectiveness determined by priority which is received from context matchers.
Context matcher just receives context and returns priority number.</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-other-wt</span><span class="p">(</span><span class="k">&amp;key</span> <span class="p">(</span><span class="nv">content</span> <span class="s">&quot;I&#39;m template&quot;</span><span class="p">)</span> <span class="k">&amp;allow-other-keys</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">with-html-to-string</span>
    <span class="p">(</span><span class="ss">:div</span> <span class="ss">:class</span> <span class="s">&quot;other-template&quot;</span> <span class="p">(</span><span class="nv">str</span> <span class="nv">content</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">deftemplate</span> <span class="ss">:my-wt</span> <span class="ss">&#39;my-other-wt</span>
  <span class="ss">:context-matches</span> <span class="p">(</span><span class="k">lambda</span><span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">context</span><span class="p">)</span>
    <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">my-other-wt</span></code> has more priority than <code class="docutils literal"><span class="pre">my-wt</span></code> so it will be called.
And this is how template overriding is done.</p>
<p>There is also <code class="docutils literal"><span class="pre">:application-class</span></code> parameter which gives template 10
more priority points.</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">deftemplate</span> <span class="ss">:page-wt</span> <span class="ss">&#39;my-customized-page-wt</span>
             <span class="ss">:application-class</span> <span class="ss">&#39;my-webapp</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal"><span class="pre">'my-customized-page-wt</span></code> function will have more priority than
one defined in Weblocks.</p>
<p>The source of Weblocks Twitter Bootstrap theme
<a class="reference external" href="https://github.com/html/weblocks-twitter-bootstrap-application">https://github.com/html/weblocks-twitter-bootstrap-application</a>
is mostly templates and their definitions. Look there for more examples.</p>
</div>
<div class="section" id="template-rendering">
<h3>Template rendering<a class="headerlink" href="#template-rendering" title="Permalink to this headline">¶</a></h3>
<p>Template rendering is done via two functions - <code class="docutils literal"><span class="pre">RENDER-WT</span></code> and
<code class="docutils literal"><span class="pre">RENDER-WT-TO-STRING</span></code>. First one renders template to
<code class="docutils literal"><span class="pre">*weblocks-output-stream*</span></code>, other one returns a string with rendered
template.</p>
<p>Rendering function takes template name, template context parameters and
other arguments which are passed to template function.</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">render-wt</span>
    <span class="ss">:checkbox-wt</span>
    <span class="p">(</span><span class="nb">list</span> <span class="ss">:name</span> <span class="nv">name</span> <span class="ss">:id</span> <span class="nv">id</span> <span class="ss">:class</span> <span class="nc">class</span><span class="p">)</span>
    <span class="ss">:name</span> <span class="p">(</span><span class="nv">attributize-name</span> <span class="nv">name</span><span class="p">)</span>
    <span class="ss">:id</span> <span class="nv">id</span>
    <span class="ss">:class</span> <span class="nc">class</span>
    <span class="ss">:value</span> <span class="p">(</span><span class="k">if</span> <span class="nv">checkedp</span> <span class="s">&quot;t&quot;</span> <span class="s">&quot;f&quot;</span><span class="p">)</span>
    <span class="ss">:checkedp</span> <span class="nv">checkedp</span>
    <span class="ss">:onclick</span> <span class="nv">onclick</span>
    <span class="ss">:disabledp</span> <span class="nv">disabledp</span><span class="p">)</span>
</pre></div>
</div>
<p>First, render function will get all templates associated to
<code class="docutils literal"><span class="pre">:checkbox-wt</span></code>, then will get every template priority based on
context, will choose effective template and call it with parameters</p>
<div class="code common-lisp highlight-common-lisp"><div class="highlight"><pre><span></span><span class="ss">:name</span> <span class="p">(</span><span class="nv">attributize-name</span> <span class="nv">name</span><span class="p">)</span>
<span class="ss">:id</span> <span class="nv">id</span>
<span class="ss">:class</span> <span class="nc">class</span>
<span class="ss">:value</span> <span class="p">(</span><span class="k">if</span> <span class="nv">checkedp</span> <span class="s">&quot;t&quot;</span> <span class="s">&quot;f&quot;</span><span class="p">)</span>
<span class="ss">:checkedp</span> <span class="nv">checkedp</span>
<span class="ss">:onclick</span> <span class="nv">onclick</span>
<span class="ss">:disabledp</span> <span class="nv">disabledp</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/components.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2017, .<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>